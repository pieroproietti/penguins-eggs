name: Build Universal AppImage

on:
  release:
    types: [created]
  workflow_dispatch: # Permette di lanciarlo a mano per test

jobs:
  build:
    runs-on: ubuntu-22.04 # Il runner di GitHub

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install dependencies for building
        run: |
          sudo apt-get update
          sudo apt-get install -y wget file

      - name: Setup pkg2appimage
        run: |
          wget -c https://github.com/AppImage/pkg2appimage/releases/download/continuous/pkg2appimage-1806-x86_64.AppImage
          chmod +x pkg2appimage-*.AppImage

      - name: Build AppImage using Recipe
        # Supponendo che tu abbia salvato la ricetta come 'AppImage/Recipe.yml' nel repo
        run: |
          ./pkg2appimage-*.AppImage AppImage/Recipe.yml

      - name: Rename AppImage
        run: |
          # Trova l'AppImage generata e rinominala in modo chiaro
          mv out/*.AppImage penguins-eggs-universal-x86_64.AppImage

      - name: Upload to Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: penguins-eggs-universal-x86_64.AppImage