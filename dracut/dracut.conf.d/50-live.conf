# ==============================================================
# 50-live.conf – Opzione A: Usa solo luks-loop
# Più semplice, compatibile con dmsquash-live standard
# ==============================================================

compress="zstd"
squash_compress="zstd"
hostonly="no"
lvmconf="no"
mdadmconf="no"
early_microcode="no"

# Moduli (SENZA 95luks, usa SOLO luks-loop)
add_dracutmodules+=" dm kernel-modules "
# add_dracutmodules+=" block "
add_dracutmodules+=" iso-scan pollcdrom "
add_dracutmodules+=" luks-loop "
add_dracutmodules+=" dmsquash-live dmsquash-live-autooverlay "
add_dracutmodules+=" livenet qemu qemu-net "
add_dracutmodules+=" debug-shell "

omit_dracutmodules+=" plymouth luks crypt systemd-cryptsetup fido2 pkcs11 "

# Parametri kernel per luks-loop + dmsquash-live
# IMPORTANTE: rd.live.squashimg punta al LUKS decifrato
kernel_cmdline="boot=live root=live:LABEL=colibri rd.luks.loop=/live/luks.img eggs.luks.uuid=fedb19f3-e117-4e94-a85c-debe41b18e5b rd.live.dir=/live rd.live.overlay.overlayfs=1 rd.shell rd.debug"

install_items+=" /usr/bin/find /usr/bin/lsblk /bin/cat "