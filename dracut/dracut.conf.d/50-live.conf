# ==============================================================
# 50-live.conf — configurazione Dracut per Live ISO cifrata
# ==============================================================

# Compressione
compress="zstd"

# Non limitare ai soli device host
hostonly="no"

# Disabilita configurazioni locali non necessarie
lvmconf="no"
mdadmconf="no"

# Compressione anche per squashfs
squash_compress="zstd"

# ==============================================================
# Moduli fondamentali per ISO live cifrata
# ==============================================================

# Moduli base live
add_dracutmodules+=" dmsquash-live dmsquash-live-autooverlay iso-scan pollcdrom "

# Moduli per cifratura su file loop (LUKS)
add_dracutmodules+=" luks luks-loop dm rootfs-block "

add_dracutmodules+=" iso-scan "

# Moduli utili per avvio generico
add_dracutmodules+=" kernel-modules qemu qemu-net livenet "

# Evita di includere Plymouth (non necessario nei live minimal)
omit_dracutmodules+=" plymouth "

# ==============================================================
# Parametri del kernel da preimpostare (opzionale)
# ==============================================================

# Etichetta della ISO — deve corrispondere a quella in xorriso (-V)
kernel_cmdline="boot=live root=live:LABEL=colibri rd.luks.loop=/live/luks.img rd.live.squashimg=filesystem.squashfs rd.live.overlay.overlayfs=1 rd.debug rd.shell"

# ==============================================================
# Ottimizzazioni
# ==============================================================

# Mantieni tool utili per debug in initramfs
install_items+=" /usr/bin/cryptsetup /usr/bin/losetup /usr/bin/find /usr/bin/lsblk /usr/bin/cat /usr/bin/mount /usr/bin/umount "

# Non fermarti se manca qualche modulo opzionale
dracutmodules_load="yes"

# Disabilita microcode early
early_microcode="no"

# ==============================================================
# Fine file
# ==============================================================
