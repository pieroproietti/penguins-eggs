#!/bin/sh
# This script would be placed in /etc/initramfs-tools/scripts/init-premount/

modprobe loop

# Find the LUKS container on the live medium
LUKS_DEV=$(find /lib/live/mount/medium -name encrypted.filesystem.squashfs | head -n 1)

if [ -n "$LUKS_DEV" ]; then
    # Prompt for passphrase and unlock
    cryptsetup open "$LUKS_DEV" live_fs

    # Tell live-boot where to find the filesystem
    # The exact mechanism can vary, but it often involves setting a variable
    export LIVE_MEDIA_PATH="/dev/mapper/live_fs/filesystem.squashfs"
fi
